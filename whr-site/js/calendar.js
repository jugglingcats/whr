window.WHR=function(t){function e(){var t=new Date,e=d3.timeFridays(d3.timeMonth(new Date),d3.timeFriday.offset(t,52)),r=e[0].toISOString(),i="https://www.googleapis.com/calendar/v3/calendars/"+a+"/events?key="+n+"&timeMin="+r;return fetch(i).then(function(t){if(200===t.status)return t.json();throw"Failed to fetch calendar data"}).then(function(t){var r=t.items.map(function(t){var e=t.start.date.split("-");return{date:new Date(e[0],e[1]-1,e[2]),properties:t.extendedProperties?t.extendedProperties["private"]:{}}});return e.map(function(t){return{date:t,event:r.find(function(e){return e.date.getTime()===t.getTime()})}})})}function r(t){function e(t){return t.event&&"Yes"!==t.event.properties.booked}for(var r=4,n=30,a=64,i=d3.timeFormat("%B"),o=[],s=[],d=t[0].date.getMonth(),u=0;u<t.length;u++){var c=t[u];c.date.getMonth()===d?s.push(c):(o.push(s),s=[c],d=c.date.getMonth())}s.length&&o.push(s);var p=d3.select("#calendar").selectAll("div").data(o,function(t,e){return t?t.date:"intro"}).enter().append("div").attr("class","month").append("div").attr("class","month-inner");p.append("div").attr("class","month-title").text(function(t){return i(t[0].date)});var l=7*n+9*r+a,f=function(t){var e=t.length;return n*(e+1)+r*(e+1)+20},h=p.append("svg").attr("class","month-block").attr("viewBox",function(t){return"0,0,"+l+","+f(t)}).attr("width",l).attr("height",f),v=(h.append("g").attr("class","day-labels").attr("transform",function(){return"translate(0 5)"}).selectAll("text.day-label").data(function(t){return["Fr","Sa","Su","Mo","Tu","We","Th"]}).enter().append("text").attr("x",n/2).attr("y",n/2+2).attr("class","day-label").attr("transform",function(t,e){return"translate("+(e*n+e*r+r)+" 0)"}).text(function(t){return t}),h.append("g").attr("class","month-weeks")),m=v.selectAll("g.week").data(function(t){return t}).enter().append("g").attr("class",function(t){return"week"+(e(t)?" week-available":"")}).attr("transform",function(t,e){return"translate(0 "+(e+1)*(n+r)+")"}),g=m.append("g").attr("class",function(t){var e=t.event&&"Yes"===t.event.properties.offer;return"price"+(e?" price-offer":"")}).attr("transform",function(){return"translate("+(7*n+7*r+r)+" 0)"});g.append("rect").attr("width",a).attr("height",n),g.append("text").attr("x",10).attr("y",n/2+2).text(function(t){return e(t)?"Yes"===t.event.properties.offer?"£"+t.event.properties.offerPrice:t.event.properties.price?"£"+t.event.properties.price:"enquire":""});var w=m.selectAll("rect.day").data(function(t){return d3.timeDays(t.date,d3.timeWeek.offset(t.date,1))}).enter().append("g").attr("transform",function(t,e){return"translate("+(e*n+e*r+r)+" 0)"});w.append("rect").attr("class","day").attr("width",n).attr("height",n).attr("rx",1).attr("ry",1),w.append("text").attr("class","day-num").attr("x",n/2).attr("y",n/2+2).text(function(t){return t.getDate()})}var n="AIzaSyBToE7lpYlcvs4wCjBzJ-JZEukfbudIXJ8",a="opiaa2jh32akudmvqsn3sma9n0@group.calendar.google.com";return t.calendar={init:function(){return e().then(function(t){r(t)})}},t}(window.WHR||{});